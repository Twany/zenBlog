---
import type { Note } from '../types';
import type { Locale } from '../utils/i18n';
import { uiLabels } from '../data/uiLabels';
import Icon from './Icon.astro';

interface Props {
  note: Note;
  lang: Locale;
  class?: string;
  truncate?: boolean;
}

const { note, lang, class: className = '', truncate = false } = Astro.props as Props;
const charLimit = 120;
const content = note.content[lang];
const shouldTruncate = truncate && content.length > charLimit;
const displayContent = shouldTruncate ? `${content.slice(0, charLimit)}...` : content;
---
<div class={`flex flex-col bg-white border border-gray-200 shadow-sm hover:shadow-lg transition-all duration-300 rounded-lg overflow-hidden break-inside-avoid ${className}`}>
  {note.image ? (
    <div class="relative h-48 w-full overflow-hidden bg-gray-100 border-b border-gray-100">
      <img
        src={note.image}
        alt="Note attachment"
        class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-500"
        loading="lazy"
      />
      <div class="absolute top-2 right-2 bg-black/50 text-white p-1 rounded-full backdrop-blur-sm">
        <Icon name="image" size={12} />
      </div>
    </div>
  ) : null}

  <div class="p-6 flex flex-col gap-4">
    <div class="flex items-center justify-between border-b border-gray-100 pb-3">
      <span class="font-mono text-xs text-brand-cyan font-bold uppercase tracking-wider">{note.date}</span>
      <div class="flex flex-wrap gap-1 justify-end">
        {note.tags?.map((tag) => (
          <span class="text-[9px] font-bold uppercase tracking-wider text-gray-500 bg-gray-50 border border-gray-200 px-2 py-0.5 rounded-sm">
            {tag}
          </span>
        ))}
      </div>
    </div>

    <p class="font-serif text-gray-700 leading-relaxed text-base">{displayContent}</p>

    {shouldTruncate ? (
      <span class="text-xs font-bold uppercase tracking-widest text-brand-cyan">
        {uiLabels.common.readMore[lang]}
      </span>
    ) : null}
  </div>
</div>
